<!DOCTYPE html>
<html lang="en">
    <!-- TEMP: wrap test -->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;500;600;700&family=Cousine:wght@400;700&display=swap" rel="stylesheet">
    <title>Job Automation Risk Calculator - Comprehensive Model</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 100%;
            margin: 0;
            background: #ffffff;
            padding: 0;
        }

        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 20px 30px;
            text-align: center;
        }

        
        h1 {
            color: white;
            margin-bottom: 15px;
            font-size: 3em;
            font-weight: 700;
            letter-spacing: -0.02em;
            line-height: 1.2;
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.3em;
            font-weight: 400;
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.5;
        }
        
        .setup-wizard {
            background: #ffffff;
            padding: 0;
            border-radius: 0;
            margin-bottom: 0;
        }
        
        .setup-section {
            margin-bottom: 30px;
        }
        
        .setup-section h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .section-category {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #2a5298;
        }
        
        .section-category h4 {
            color: #2a5298;
            margin-bottom: 15px;
            font-size: 1.1em;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-category h4:hover {
            color: #1e3c72;
        }

        .expand-icon {
            font-size: 0.9em;
            transition: transform 0.3s;
        }

        .expand-icon.rotated {
            transform: rotate(180deg);
        }

        .question-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 16px;
        }

        @media (max-width: 1000px) {
            .question-grid {
                grid-template-columns: 1fr;
            }
        }

        .additional-questions {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .additional-questions.expanded {
            max-height: 2000px;
        }
        
        .role-presets {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .preset-btn {
            padding: 12px 20px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95em;
            position: relative;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            white-space: normal;
            text-align: center;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.3;
        }
        
        
        
        .preset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .preset-btn.active {
            background: #2a5298;
            color: white;
            border-color: #2a5298;
        }
        
        .custom-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            margin-bottom: 10px;
        }
        
        .question-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .question-group h5 {
            font-family: 'Sora', sans-serif;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.95em;
            font-weight: 600;
            line-height: 1.4;
        }

        .question-group p {
            font-family: 'Sora', sans-serif;
            color: #666;
            font-size: 0.85em;
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .radio-option {
            flex: 1 1 auto;
            min-width: 100px;
            max-width: 150px;
        }
        
        .radio-option input[type="radio"] {
            display: none;
        }
        
        .radio-option label {
            font-family: 'Sora', sans-serif;
            display: block;
            padding: 10px 14px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            font-size: 0.9em;
            font-weight: 500;
            line-height: 1.3;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .radio-option input[type="radio"]:checked + label {
            background: #2a5298;
            color: white;
            border-color: #2a5298;
        }
        
        .analyze-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .analyze-btn:hover {
            transform: translateY(-2px);
        }
        
        .two-column-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-top: 20px;
        }

        .left-column {
            min-width: 0;
        }

        .right-column {
            min-width: 0;
            position: sticky;
            top: 100px;
            align-self: start;
        }

        @media (max-width: 1200px) {
            .two-column-layout {
                grid-template-columns: 1fr;
            }

            .right-column {
                position: static;
            }
        }
        
        .parameter-breakdown {
            background: #f0f8ff;
            padding: 12px 14px;
            border-radius: 8px;
            margin-bottom: 16px;
            border-left: 3px solid #2a5298;
        }

        .parameter-breakdown h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .profile-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .profile-scores {
            display: flex;
            flex-direction: column;
        }

        .profile-timeline {
            border-left: 1px solid #ddd;
            padding-left: 24px;
            display: flex;
            flex-direction: column;
        }

        .section-title {
            font-size: 1em;
            margin-bottom: 12px;
            color: #1f1c18;
            font-weight: 600;
            padding-bottom: 8px;
            border-bottom: 2px solid #e6e0d4;
        }

        .parameter-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 0.9em;
        }

        .parameter-item:last-child {
            border-bottom: none;
        }
        
        .parameter-label {
            color: #666;
            font-size: 1em;
        }

        .parameter-value {
            font-weight: 600;
            color: #333;
            font-size: 1em;
        }
        
        .timeline-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .timeline-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }
        
        .timeline-card h4 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .timeline-event {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            flex: 0 0 auto;
        }
        
        .timeline-date {
            font-weight: 600;
            color: #2a5298;
            margin-right: 10px;
            min-width: 65px;
            font-size: 0.9em;
        }

        .timeline-description {
            color: #666;
            font-size: 0.9em;
            line-height: 1.4;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .control-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }
        
        .control-group h3 {
            color: #495057;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        .control-group p {
            color: #6c757d;
            font-size: 0.9em;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        input[type="range"] {
            flex: 1;
            height: 6px;
            background: #ddd;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #2a5298;
            border-radius: 50%;
            cursor: pointer;
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #2a5298;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .value-display {
            min-width: 60px;
            text-align: right;
            font-weight: bold;
            color: #333;
        }
        
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        canvas {
            max-width: 100%;
            height: 400px;
        }
        
        .results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .result-card {
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            position: relative;
        }
        
        .result-card.critical {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }
        
        .result-card h4 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .result-value {
            font-size: 2em;
            font-weight: bold;
        }

        .model-insights {
            margin-top: 20px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 16px 20px;
            line-height: 1.4;
        }

        .model-insights p {
            margin: 4px 0;
            color: #495057;
            font-size: 0.95em;
        }

        .progress-indicator {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            transition: width 0.3s;
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .hero-section {
                padding: 60px 20px 40px;
            }

            .content-wrapper {
                width: 95%;
                padding: 30px 15px;
            }

            .model-explanation {
                padding: 15px !important;
            }

            .model-explanation h3 {
                font-size: 1.1em;
            }

            .ai-equation-display {
                padding: 15px !important;
                font-size: 0.9em;
            }

            .ai-equation-display h3 {
                font-size: 1em;
            }

            h1 {
                font-size: 2em;
                margin-bottom: 12px;
            }

            .subtitle {
                font-size: 1.1em;
                margin-bottom: 0;
            }
            .setup-wizard {
                padding: 15px;
            }

            .setup-section h3 {
                font-size: 1em;
            }

            .role-presets {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 8px;
            }

            .preset-btn {
                padding: 10px 12px;
                font-size: 0.85em;
            }

            .section-category {
                padding: 15px;
            }

            .section-category h4 {
                font-size: 1em;
            }

            .question-group h5 {
                font-size: 0.9em;
            }

            .question-group p {
                font-size: 0.8em;
            }

            .radio-group {
                flex-direction: column;
                gap: 6px;
            }

            .radio-option {
                min-width: auto;
            }

            .radio-option label {
                padding: 10px;
                font-size: 0.85em;
            }

            .timeline-comparison {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .timeline-card {
                padding: 15px;
            }

            .controls-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .control-group {
                padding: 15px;
            }

            .control-group h3 {
                font-size: 1em;
            }

            .control-group p {
                font-size: 0.85em;
            }

            .chart-container {
                padding: 10px;
            }

            canvas {
                height: 300px !important;
            }

            .results {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: 10px;
            }

            .result-card {
                padding: 15px;
            }

            .result-card h4 {
                font-size: 0.8em;
            }

            .result-value {
                font-size: 1.5em;
            }

            .analyze-btn {
                padding: 12px;
                font-size: 1em;
            }

            .custom-input {
                font-size: 0.9em;
                padding: 8px;
            }

            .parameter-breakdown {
                padding: 15px;
            }

            .parameter-breakdown h3 {
                font-size: 1em;
            }

            .profile-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .profile-timeline {
                border-left: none;
                border-top: 1px solid #ddd;
                padding-left: 0;
                padding-top: 12px;
            }

            .parameter-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .parameter-label,
            .parameter-value {
                font-size: 0.9em;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.3em;
            }

            .role-presets {
                grid-template-columns: 1fr;
            }

            .results {
                grid-template-columns: 1fr;
            }

            .slider-container {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }

            .value-display {
                text-align: left;
            }
        }

        /* Substack-inspired refresh */
        body {
            font-family: 'Inter', 'Segoe UI', sans-serif;
            background: #faf7f1;
            color: #1f1c18;
            line-height: 1.7;
            min-height: 100vh;
        }

        .container {
            width: 92.5%;
            max-width: none;
            margin: 0 auto;
            padding: 0 0 96px;
            background: transparent;
        }

        .hero-section {
            background: transparent;
            color: inherit;
            padding: 96px 0 48px;
            text-align: left;
            border-bottom: 1px solid #e6e0d4;
            margin-bottom: 48px;
        }

        .hero-section h1 {
            font-family: 'Sora', sans-serif;
            font-size: clamp(2.8rem, 4vw, 3.6rem);
            letter-spacing: -0.015em;
            color: #1f1c18;
            font-weight: 600;
        }

        .subtitle {
            color: #5c564f;
            font-size: 1.15rem;
            margin-top: 16px;
            max-width: 32ch;
        }

        .content-wrapper {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
        }

        .narrow-content {
            width: 100%;
            margin: 0 auto;
        }

        p {
            margin-bottom: 1.2em;
            color: #3f392f;
        }

        h2,
        h3,
        h4 {
            font-family: 'Sora', sans-serif;
            color: #1f1c18;
            font-weight: 600;
        }

        .site-header {
            position: static;
            backdrop-filter: blur(12px);
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid #e6e0d4;
        }

        .header-inner {
            width: 92.5%;
            max-width: none;
            margin: 0 auto;
            padding: 20px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 24px;
        }

        .header-brand {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .header-actions {
            display: flex;
            gap: 24px;
            align-items: center;
        }

        .header-btn {
            background: #fdf8f0;
            color: #1f1c18;
            border: 1px solid #e6e0d4;
            border-radius: 6px;
            padding: 14px 32px;
            font-size: 1.05rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .header-btn:hover {
            background: #f5eee0;
            border-color: #d9d2c4;
            color: #000000;
        }

        .header-btn.active {
            background: #1f1c18;
            color: #ffffff;
            border-color: #1f1c18;
            box-shadow: 0 12px 28px rgba(31, 28, 24, 0.2);
        }

        .publication-title {
            font-family: 'Sora', sans-serif;
            font-size: 1.4rem;
            letter-spacing: 0.02em;
        }

        .publication-tagline {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: #5c564f;
            font-weight: 600;
        }

        .author-link {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: #6ba3d4;
            text-decoration: none;
            transition: color 0.3s;
            font-weight: 600;
        }

        .author-link:hover {
            color: #4a8bc2;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .header-button {
            border: 1px solid #1f1c18;
            background: #1f1c18;
            color: #ffffff;
            padding: 10px 24px;
            border-radius: 999px;
            font-size: 0.85rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .header-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 24px rgba(31, 28, 24, 0.15);
        }

        .header-button--ghost {
            background: transparent;
            color: #1f1c18;
        }

        .eyebrow {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: #1f1c18;
            font-weight: 600;
        }

        .model-explanation {
            background: #ffffff;
            border: 1px solid #e6e0d4;
            border-radius: 24px;
            padding: 48px;
            box-shadow: 0 32px 80px rgba(15, 23, 42, 0.05);
            margin-bottom: 16px;
        }

        .model-explanation h2 {
            margin-bottom: 1rem;
        }

        .ai-equation {
            background: #ffffff;
            border: 1px solid #e6e0d4;
            border-radius: 24px;
            padding: 48px;
            box-shadow: 0 32px 80px rgba(15, 23, 42, 0.05);
            margin: 72px 0 64px;
        }

        .section-intro {
            margin-bottom: 24px;
        }

        .section-intro p {
            color: #5c564f;
        }

        .equation-callout {
            margin: 24px 0;
            padding: 20px 24px;
            border-left: 4px solid #d2c7b8;
            background: #fefbf5;
            border-radius: 18px;
        }

        .callout-label {
            display: block;
            font-size: 0.8rem;
            letter-spacing: 0.12em;
            color: #3b3326;
            text-transform: uppercase;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .equation-callout code {
            font-family: 'Cousine', 'Menlo', monospace;
            font-size: 0.95rem;
            color: #3b3326;
            background: transparent;
        }

        .equation-display {
            font-size: 1.1rem;
            color: #3b3326;
            overflow-x: auto;
            padding: 8px 0;
        }

        .factor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
            margin: 32px 0;
            list-style: none;
            padding: 0;
        }

        .factor-grid li {
            background: #ffffff;
            border: 1px solid #e6e0d4;
            border-radius: 16px;
            padding: 16px 18px;
            font-size: 0.95rem;
            color: #3f392f;
            box-shadow: 0 14px 40px rgba(15, 23, 42, 0.04);
        }

        .factor-grid--compact {
            margin-top: 24px;
        }

        .note {
            font-size: 0.85rem;
            color: #8c857d;
            font-style: italic;
        }

        .inline-link {
            color: #a35d2c;
            text-decoration: underline;
            transition: color 0.2s ease;
        }

        .inline-link:hover {
            color: #703b16;
        }
        .setup-wizard {
            background: #ffffff;
            border: 1px solid #e6e0d4;
            border-radius: 24px;
            padding: 48px 48px 56px;
            box-shadow: 0 32px 80px rgba(15, 23, 42, 0.05);
        }

        .setup-section {
            border-top: 1px solid #eee5d7;
            padding-top: 32px;
            margin-top: 32px;
        }

        .setup-section:first-of-type {
            border-top: none;
            padding-top: 0;
            margin-top: 0;
        }

        .role-presets {
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
        }

        .preset-btn {
            border-radius: 16px;
            border: 1px solid #d9d2c4;
            background: #fdfaf4;
            padding: 14px 18px;
            font-weight: 500;
            color: #4b453c;
            transition: all 0.2s ease;
        }

        .preset-btn:hover,
        .preset-btn.active {
            background: #1f1c18;
            color: #ffffff;
            border-color: #1f1c18;
            box-shadow: 0 12px 28px rgba(31, 28, 24, 0.2);
        }

        label {
            color: #3f392f;
            font-weight: 500;
        }

        input,
        select,
        textarea {
            border-radius: 14px;
            border: 1px solid #d9d2c4;
            padding: 12px 14px;
            font-size: 0.95rem;
            background: #fdfaf4;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: 2px solid rgba(31, 28, 24, 0.25);
        }

        input[type="range"] {
            accent-color: #1f1c18;
        }

        .progress-indicator {
            display: flex;
            flex-direction: column;
            gap: 12px;
            color: #3b3326;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 16px;
            margin-top: -12px;
        }

        .progress-bar {
            height: 6px;
            background: #f1eadf;
            border-radius: 999px;
            overflow: hidden;
        }

        .progress-fill {
            background: #1f1c18;
            width: 0;
            height: 100%;
            border-radius: inherit;
        }

        .timeline-comparison {
            display: grid;
            gap: 20px;
            margin: 48px 0;
        }

        .timeline-card {
            background: #ffffff;
            border: 1px solid #e6e0d4;
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 18px 48px rgba(15, 23, 42, 0.05);
        }

        .timeline-card h4 {
            margin-bottom: 12px;
        }

        .timeline-event {
            display: flex;
            gap: 12px;
            margin-bottom: 10px;
            color: #3f392f;
        }

        .timeline-date {
            font-weight: 600;
            font-family: 'Cousine', 'Menlo', monospace;
            color: #a35d2c;
        }

        .controls-grid {
            display: grid;
            gap: 24px;
            margin: 56px 0 48px;
        }

        .control-group {
            background: #ffffff;
            border: 1px solid #e6e0d4;
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 16px 42px rgba(15, 23, 42, 0.05);
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .value-display {
            font-family: 'Cousine', 'Menlo', monospace;
            color: #8c857d;
            font-size: 0.9rem;
        }

        .chart-container {
            background: #ffffff;
            border: 1px solid #e6e0d4;
            border-radius: 24px;
            padding: 24px;
            box-shadow: 0 24px 60px rgba(15, 23, 42, 0.05);
            margin-bottom: 48px;
        }

        .results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 18px;
            margin-top: 48px;
        }

        .result-card {
            border-radius: 20px;
            border: 1px solid #e6e0d4;
            background: linear-gradient(180deg, #ffffff 0%, #fdf8f0 100%);
            box-shadow: 0 24px 60px rgba(15, 23, 42, 0.05);
            padding: 24px;
            text-align: left;
        }

        .result-card h4 {
            font-size: 0.95rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: #8c857d;
        }

        .result-value {
            font-family: 'Sora', sans-serif;
            font-size: 2rem;
            color: #1f1c18;
            margin-top: 8px;
        }

        .result-card.critical {
            /* Removed red/orange background styling */
        }

        .footer-note {
            color: #8c857d;
            font-size: 0.85rem;
            margin-top: 32px;
        }

        .parameter-summary,
        .parameter-item {
            color: #3f392f;
        }

        @media (max-width: 720px) {
            .header-inner {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }

            .header-actions {
                width: 100%;
                justify-content: flex-start;
            }

            .header-btn {
                padding: 12px 24px;
                font-size: 0.95rem;
            }

            .container {
                padding: 0 20px 80px;
            }

            .hero-section {
                padding: 64px 0 40px;
            }

            .model-explanation,
            .ai-equation,
            .setup-wizard {
                padding: 32px 24px;
            }

            /* Stack equation grids on mobile */
            [style*="grid-template-columns: 1fr 1fr"] {
                grid-template-columns: 1fr !important;
            }
        }
    </style>
</head>
<body>
    <header class="site-header">
        <div class="header-inner">
            <div class="header-brand">
                <span class="publication-title">Don't Lose Your Job</span>
                <span class="publication-tagline">Forecasting work in the age of AI</span>
                <a href="https://x.com/wrenclay" target="_blank" class="author-link">Clay Wren</a>
            </div>
            <div class="header-actions">
                <button class="header-btn active" data-page="/">Calculator</button>
                <button class="header-btn" data-page="/guide">Guide</button>
            </div>
        </div>
    </header>
    <div class="container">
        <div class="content-wrapper">

            <div class="two-column-layout">
                <div class="left-column">
                    <div class="setup-wizard" id="setup-wizard">
            <div class="progress-indicator">
                <div>Complete all sections below for personalized analysis</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
            </div>

            <div class="setup-section">
                <h3>Step 1: Select Your Role Category</h3>
                <div class="role-presets">
                    <button class="preset-btn" data-role="software">
                        Software/Tech
                    </button>
                    <button class="preset-btn" data-role="admin">
                        Administrative
                    </button>
                    <button class="preset-btn" data-role="customer-service">
                        Customer Service
                    </button>
                    <button class="preset-btn" data-role="data-analysis">
                        Data Analysis
                    </button>
                    <button class="preset-btn" data-role="finance">
                        Finance/Accounting
                    </button>
                    <button class="preset-btn" data-role="sales">
                        Sales/Marketing
                    </button>
                    <button class="preset-btn" data-role="creative">
                        Creative/Design
                    </button>
                    <button class="preset-btn" data-role="manufacturing">
                        Manufacturing
                    </button>
                    <button class="preset-btn" data-role="legal">
                        Legal/Compliance
                    </button>
                    <button class="preset-btn" data-role="healthcare">
                        Healthcare
                    </button>
                    <button class="preset-btn" data-role="education">
                        Education
                    </button>
                    <button class="preset-btn" data-role="management">
                        Management
                    </button>
                    <button class="preset-btn" data-role="custom">Other/Custom</button>
                </div>
                <input type="text" class="custom-input" id="custom-role" placeholder="Or type your specific role (e.g., Machine Learning Engineer, Product Manager)">
            </div>

            <div class="setup-section">
                <h3>Step 2: Your Seniority Level</h3>
                <div class="question-group">
                    <p>Higher seniority levels involve more strategic decision-making and are typically harder to automate</p>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="seniority-1" name="seniority" value="1" checked>
                            <label for="seniority-1">Entry Level</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="seniority-2" name="seniority" value="2">
                            <label for="seniority-2">Mid-Level</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="seniority-3" name="seniority" value="3">
                            <label for="seniority-3">Senior</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="seniority-4" name="seniority" value="4">
                            <label for="seniority-4">Lead/Principal</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="seniority-5" name="seniority" value="5">
                            <label for="seniority-5">Executive</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="setup-section">
                <h3>Step 3: AI Displacement Risk Assessment</h3>

                <div class="section-category">
                    <h4>AI Technical Readiness</h4>

                    <div class="question-grid">
                    <div class="question-group">
                        <h5>1. Current AI Performance</h5>
                        <p>How well can AI already perform core tasks in your field?</p>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="q1-1" name="q1" value="1">
                                <label for="q1-1">Very Poor</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q1-2" name="q1" value="2">
                                <label for="q1-2">Limited</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q1-3" name="q1" value="3" checked>
                                <label for="q1-3">Moderate</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q1-4" name="q1" value="4">
                                <label for="q1-4">Good</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q1-5" name="q1" value="5">
                                <label for="q1-5">Near-Human</label>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <h5>2. Data Availability</h5>
                        <p>How much training data exists for AI to learn your role?</p>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="q2-1" name="q2" value="1">
                                <label for="q2-1">Very Limited</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q2-2" name="q2" value="2">
                                <label for="q2-2">Limited</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q2-3" name="q2" value="3" checked>
                                <label for="q2-3">Moderate</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q2-4" name="q2" value="4">
                                <label for="q2-4">Abundant</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q2-5" name="q2" value="5">
                                <label for="q2-5">Very Abundant</label>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <h5>3. Benchmark Clarity</h5>
                        <p>How easily can success in your role be measured objectively?</p>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="q3-1" name="q3" value="1">
                                <label for="q3-1">Very Hard</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q3-2" name="q3" value="2">
                                <label for="q3-2">Difficult</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q3-3" name="q3" value="3" checked>
                                <label for="q3-3">Moderate</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q3-4" name="q3" value="4">
                                <label for="q3-4">Fairly Easy</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q3-5" name="q3" value="5">
                                <label for="q3-5">Very Easy</label>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <h5>4. Task Digitization</h5>
                        <p>What percentage of your tasks are completed and delivered in digital/text format?</p>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="q4-1" name="q4" value="1">
                                <label for="q4-1">0-20%</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q4-2" name="q4" value="2">
                                <label for="q4-2">21-40%</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q4-3" name="q4" value="3" checked>
                                <label for="q4-3">41-60%</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q4-4" name="q4" value="4">
                                <label for="q4-4">61-80%</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q4-5" name="q4" value="5">
                                <label for="q4-5">81-100%</label>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>

                <div class="section-category">
                    <h4>Task Structure & Adaptability</h4>

                    <div class="question-grid">
                    <div class="question-group">
                        <h5>5. Task Decomposability</h5>
                        <p>Can your work be broken into discrete, measurable tasks?</p>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="q5-1" name="q5" value="1">
                                <label for="q5-1">Very Complex</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q5-2" name="q5" value="2">
                                <label for="q5-2">Complex</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q5-3" name="q5" value="3" checked>
                                <label for="q5-3">Mixed</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q5-4" name="q5" value="4">
                                <label for="q5-4">Structured</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q5-5" name="q5" value="5">
                                <label for="q5-5">Highly Structured</label>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <h5>6. Task Standardization</h5>
                        <p>How standardized are procedures/workflows in your role?</p>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="q6-1" name="q6" value="1">
                                <label for="q6-1">Highly Variable</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q6-2" name="q6" value="2">
                                <label for="q6-2">Variable</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q6-3" name="q6" value="3" checked>
                                <label for="q6-3">Somewhat Standard</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q6-4" name="q6" value="4">
                                <label for="q6-4">Standardized</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q6-5" name="q6" value="5">
                                <label for="q6-5">Highly Standardized</label>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <h5>7. Context Dependency</h5>
                        <p>How much does your work require understanding unique organizational context?</p>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="q7-1" name="q7" value="5">
                                <label for="q7-1">Critical</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q7-2" name="q7" value="4">
                                <label for="q7-2">Very Important</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q7-3" name="q7" value="3" checked>
                                <label for="q7-3">Moderate</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q7-4" name="q7" value="2">
                                <label for="q7-4">Some Needed</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q7-5" name="q7" value="1">
                                <label for="q7-5">Minimal</label>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <h5>8. Feedback Loop Speed</h5>
                        <p>How quickly do you get feedback on work quality?</p>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="q8-1" name="q8" value="1">
                                <label for="q8-1">Months/Years</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q8-2" name="q8" value="2">
                                <label for="q8-2">Weeks</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q8-3" name="q8" value="3" checked>
                                <label for="q8-3">Days</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q8-4" name="q8" value="4">
                                <label for="q8-4">Hours</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q8-5" name="q8" value="5">
                                <label for="q8-5">Minutes/Instant</label>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <h5>9. Tacit Knowledge</h5>
                        <p>How much of your expertise is documented vs. learned through experience?</p>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="q9-1" name="q9" value="5">
                                <label for="q9-1">Mostly Tacit</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q9-2" name="q9" value="4">
                                <label for="q9-2">Largely Tacit</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q9-3" name="q9" value="3" checked>
                                <label for="q9-3">Mixed</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q9-4" name="q9" value="2">
                                <label for="q9-4">Largely Documented</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q9-5" name="q9" value="1">
                                <label for="q9-5">Fully Documented</label>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>

                <div class="section-category">
                    <h4>Human & Organizational Factors</h4>

                    <div class="question-grid">
                    <div class="question-group">
                        <h5>10. Human Judgment & Relationships</h5>
                        <p>How critical are human relationships, empathy, and trust in your role?</p>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="q10-1" name="q10" value="5">
                                <label for="q10-1">Essential</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q10-2" name="q10" value="4">
                                <label for="q10-2">Very Important</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q10-3" name="q10" value="3" checked>
                                <label for="q10-3">Moderate</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q10-4" name="q10" value="2">
                                <label for="q10-4">Some Needed</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q10-5" name="q10" value="1">
                                <label for="q10-5">Minimal</label>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <h5>11. Physical Presence</h5>
                        <p>How much does your work require physical presence?</p>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="q11-1" name="q11" value="5">
                                <label for="q11-1">Essential</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q11-2" name="q11" value="4">
                                <label for="q11-2">Very Important</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q11-3" name="q11" value="3" checked>
                                <label for="q11-3">Moderate</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q11-4" name="q11" value="2">
                                <label for="q11-4">Some</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q11-5" name="q11" value="1">
                                <label for="q11-5">None</label>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <h5>12. Trust Requirements</h5>
                        <p>How critical is established personal trust with clients/patients/students?</p>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="q12-1" name="q12" value="5">
                                <label for="q12-1">Critical</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q12-2" name="q12" value="4">
                                <label for="q12-2">Very Important</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q12-3" name="q12" value="3" checked>
                                <label for="q12-3">Important</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q12-4" name="q12" value="2">
                                <label for="q12-4">Somewhat</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q12-5" name="q12" value="1">
                                <label for="q12-5">Not Important</label>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>

                <div class="section-category">
                    <h4>Company & Industry Context</h4>

                    <div class="question-grid">
                    <div class="question-group">
                        <h5>13. Company AI Adoption Readiness</h5>
                        <p>How prepared is your organization for AI integration?</p>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="q13-1" name="q13" value="1">
                                <label for="q13-1">Resistant</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q13-2" name="q13" value="2">
                                <label for="q13-2">Cautious</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q13-3" name="q13" value="3" checked>
                                <label for="q13-3">Exploring</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q13-4" name="q13" value="4">
                                <label for="q13-4">Adopting</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q13-5" name="q13" value="5">
                                <label for="q13-5">Leading Edge</label>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <h5>14. Labor Cost Pressure</h5>
                        <p>How cost-sensitive is your employer to labor expenses?</p>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="q14-1" name="q14" value="1">
                                <label for="q14-1">Not Sensitive</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q14-2" name="q14" value="2">
                                <label for="q14-2">Somewhat</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q14-3" name="q14" value="3" checked>
                                <label for="q14-3">Moderate</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q14-4" name="q14" value="4">
                                <label for="q14-4">Very Sensitive</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q14-5" name="q14" value="5">
                                <label for="q14-5">Extremely Sensitive</label>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <h5>15. Labor Market Tightness</h5>
                        <p>How difficult is it to hire people with your skills?</p>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="q15-1" name="q15" value="5">
                                <label for="q15-1">Very Difficult</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q15-2" name="q15" value="4">
                                <label for="q15-2">Difficult</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q15-3" name="q15" value="3" checked>
                                <label for="q15-3">Moderate</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q15-4" name="q15" value="2">
                                <label for="q15-4">Easy</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q15-5" name="q15" value="1">
                                <label for="q15-5">Very Easy</label>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <h5>16. IT Infrastructure</h5>
                        <p>How modern is your organization's technical infrastructure?</p>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="q16-1" name="q16" value="1">
                                <label for="q16-1">Very Outdated</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q16-2" name="q16" value="2">
                                <label for="q16-2">Outdated</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q16-3" name="q16" value="3" checked>
                                <label for="q16-3">Current</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q16-4" name="q16" value="4">
                                <label for="q16-4">Modern</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q16-5" name="q16" value="5">
                                <label for="q16-5">Cutting Edge</label>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>

                <div class="section-category">
                    <h4>Personal Adaptability</h4>

                    <div class="question-grid">
                    <div class="question-group">
                        <h5>17. Skill Transferability</h5>
                        <p>How transferable are your core skills to other roles/industries?</p>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="q17-1" name="q17" value="1">
                                <label for="q17-1">Highly Specific</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q17-2" name="q17" value="2">
                                <label for="q17-2">Somewhat Specific</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q17-3" name="q17" value="3" checked>
                                <label for="q17-3">Moderate</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q17-4" name="q17" value="4">
                                <label for="q17-4">Transferable</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q17-5" name="q17" value="5">
                                <label for="q17-5">Highly Transferable</label>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <h5>18. AI Complementarity</h5>
                        <p>How much could AI amplify (vs. replace) your productivity?</p>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="q18-1" name="q18" value="1">
                                <label for="q18-1">Replace Only</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q18-2" name="q18" value="2">
                                <label for="q18-2">Mostly Replace</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q18-3" name="q18" value="3" checked>
                                <label for="q18-3">Mixed</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q18-4" name="q18" value="4">
                                <label for="q18-4">Mostly Amplify</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q18-5" name="q18" value="5">
                                <label for="q18-5">Amplify Only</label>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <h5>19. Adaptability/Learning</h5>
                        <p>How quickly can you learn and adopt new tools/technologies?</p>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="q19-1" name="q19" value="1">
                                <label for="q19-1">Very Slow</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q19-2" name="q19" value="2">
                                <label for="q19-2">Slow</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q19-3" name="q19" value="3" checked>
                                <label for="q19-3">Moderate</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q19-4" name="q19" value="4">
                                <label for="q19-4">Fast</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q19-5" name="q19" value="5">
                                <label for="q19-5">Very Fast</label>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <h5>20. Job Performance</h5>
                        <p>How good are you at your job, relative to your peers?</p>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="q20-1" name="q20" value="1">
                                <label for="q20-1">Below Average</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q20-2" name="q20" value="2">
                                <label for="q20-2">Average</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q20-3" name="q20" value="3" checked>
                                <label for="q20-3">Above Average</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q20-4" name="q20" value="4">
                                <label for="q20-4">Excellent</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q20-5" name="q20" value="5">
                                <label for="q20-5">Top Performer</label>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
            </div>
                    </div>
                </div>

                <div class="right-column" id="results-column">

            <div class="parameter-breakdown">
                <div class="profile-grid">
                    <div class="profile-scores">
                        <h4 class="section-title">Your Risk Profile</h4>
                        <div class="parameter-item">
                            <span class="parameter-label">Role:</span>
                            <span class="parameter-value" id="role-display">-</span>
                        </div>
                        <div class="parameter-item">
                            <span class="parameter-label">AI Readiness:</span>
                            <span class="parameter-value" id="ai-readiness-display">-</span>
                        </div>
                        <div class="parameter-item">
                            <span class="parameter-label">Task Adaptability:</span>
                            <span class="parameter-value" id="task-adapt-display">-</span>
                        </div>
                        <div class="parameter-item">
                            <span class="parameter-label">Friction:</span>
                            <span class="parameter-value" id="friction-display">-</span>
                        </div>
                        <div class="parameter-item">
                            <span class="parameter-label">Firm Readiness:</span>
                            <span class="parameter-value" id="firm-display">-</span>
                        </div>
                        <div class="parameter-item">
                            <span class="parameter-label">Personal Adapt:</span>
                            <span class="parameter-value" id="personal-display">-</span>
                        </div>
                    </div>

                    <div class="profile-timeline">
                        <h4 class="section-title">Your Automation Timeline</h4>
                        <div id="personal-timeline"></div>
                    </div>
                </div>

            </div>
            
            <div class="controls-grid">
                <div class="control-group">
                    <h3>AI Progress Speed</h3>
                    <p>Capability doubling time (METR trendline: 7 months)</p>
                    <div class="slider-container">
                        <input type="range" id="ai-doubling" min="2" max="24" step="1" value="7">
                        <span class="value-display" id="ai-doubling-value">7 mo</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>Compute Scaling</h3>
                    <p>Annual compute growth</p>
                    <div class="slider-container">
                        <input type="range" id="compute-scaling" min="1.5" max="5" step="0.1" value="3.4">
                        <span class="value-display" id="compute-scaling-value">3.4x</span>
                    </div>
                </div>

                <div class="control-group">
                    <h3>Industry Friction</h3>
                    <p>More friction  slower adoption  later automation</p>
                    <div class="slider-container">
                        <input type="range" id="industry-pace" min="0.5" max="2" step="0.1" value="1">
                        <span class="value-display" id="industry-pace-value">1.0x</span>
                    </div>
                </div>

                <div class="control-group">
                    <h3>AI Reliability</h3>
                    <p>Success rate required before automation</p>
                    <div class="slider-container">
                        <input type="range" id="ai-reliability" min="50" max="99" step="1" value="95">
                        <span class="value-display" id="ai-reliability-value">95%</span>
                    </div>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="chart"></canvas>
            </div>

            <div class="results">
                <div class="result-card" id="median-card">
                    <h4>50% Job Loss Risk</h4>
                    <div class="result-value" id="median-year">-</div>
                </div>
                <div class="result-card" id="high-card">
                    <h4>90% Job Loss Risk</h4>
                    <div class="result-value" id="high-year">-</div>
                </div>
                <div class="result-card" id="risk5-card">
                    <h4>Risk by 2030</h4>
                    <div class="result-value" id="risk-2030">-</div>
                </div>
                <div class="result-card" id="risk10-card">
                    <h4>Risk by 2031</h4>
                    <div class="result-value" id="risk-2031">-</div>
                </div>
                <div class="result-card" id="reemployment-card">
                    <h4>Re-employment Likelihood</h4>
                    <div class="result-value" id="reemployment-value">-</div>
                </div>
            </div>
            <div class="model-insights">
                <p><strong>Role explicitness (s_e):</strong> <span id="insight-explicitness">-</span></p>
                <p><strong>Required quality :</strong> <span id="insight-theta">-</span></p>
                <p><strong>Pace vs METR:</strong> <span id="insight-pace">-</span></p>
                <p><strong>Adoption friction:</strong> <span id="insight-friction">-</span></p>
                <p><strong>Domain alignment:</strong> <span id="insight-alignment">-</span></p>
            </div>
            <section class="ai-equation">
                <div class="section-intro">
                    <span class="eyebrow">How this works</span>
                    <h3>METR-powered stacked hazard model</h3>
                    <p>This calculator uses METR's empirical 7-month AI capability doubling benchmark inside a stacked hazard framework. Each channel (AI progress, macro shocks, firm execution, role design, personal leverage) stays in the template so new evidence can switch it on without rewriting the model.</p>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                    <div class="equation-callout">
                        <span class="callout-label">Survival relationship</span>
                        <div class="equation-display">$$P_{\text{loss}}(t) = 1 - S(t) = 1 - \exp\left(-\int_0^t \lambda_{\text{total}}(s) \, ds\right)$$</div>
                    </div>
                    <div class="equation-callout">
                        <span class="callout-label">Total hazard (stacked framework)</span>
                        <div class="equation-display">$$\lambda_{\text{total}}(s) = \lambda_{\text{AI}}(s) + \lambda_{\text{macro}}(s) + \lambda_{\text{firm}}(s) + \lambda_{\text{role}}(s) + \lambda_{\text{personal}}(s)$$</div>
                    </div>
                </div>


                <h4 style="color: #2a5298; margin: 30px 0 15px 0; font-size: 1.1em;">METR Capability  Readiness</h4>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
                    <div class="equation-callout">
                        <span class="callout-label">AI capability (task completion time)</span>
                        <div class="equation-display">$$H_r(t) = \frac{H_{50,0}}{2^{(t \cdot 12)/D} \cdot f(r)}, \quad D = 7 \text{ months}, \quad f(r) = \frac{\ln(r)}{\ln(0.5)}$$</div>
                    </div>

                    <div class="equation-callout">
                        <span class="callout-label">Task bucket logistic gate</span>
                        <div class="equation-display">$$G(H, L_i, s) = \frac{1}{1 + \exp\left(-\frac{\ln(H) - \ln(L_i)}{s}\right)}$$</div>
                    </div>
                </div>

                <div class="equation-callout" style="margin: 15px 0 20px 0;">
                    <span class="callout-label">AI Readiness (bounded [0,1])</span>
                    <div class="equation-display">$$A(t) = \sum_{i} w_i \cdot G(H_r(t), L_i, s), \quad \sum_{i} w_i = 1$$</div>
                </div>

                <p><strong>How it works:</strong> METR defines how AI capability grows exponentially (H<sub>r</sub> decreases as AI gets faster). Task bucket mapping translates raw capability into job-specific readiness A(t), bounded between 0 (can't do any tasks) and 1 (can do all tasks). Reliability r (e.g., 95%) requires extra capability margin, delaying milestones. Faster doubling (smaller D) accelerates the timeline.</p>

                <h4 style="color: #2a5298; margin: 30px 0 15px 0; font-size: 1.1em;">AI Hazard Core</h4>

                <div class="equation-callout">
                    <span class="callout-label">Logistic hazard gate</span>
                    <div class="equation-display">$$\lambda_{\text{AI}}(t) = \frac{h_{\text{AI}}}{1 + \exp(-\gamma \cdot (A(t) - \theta_0))} \times \text{userMult}$$</div>
                </div>

                <ul class="factor-grid factor-grid--compact">
                    <li><strong>t:</strong> Time (years from present)</li>
                    <li><strong>H<sub>r</sub>(t):</strong> AI capability (task time in minutes; lower = more capable)</li>
                    <li><strong>A(t):</strong> AI Readiness  [0,1] (fraction of job tasks AI can perform)</li>
                    <li><strong>D:</strong> Doubling period (7 months baseline, from METR benchmarks)</li>
                    <li><strong>f(r):</strong> Reliability adjustment (r=0.95 default, requires 14.4 capability margin)</li>
                    <li><strong>L<sub>i</sub>:</strong> Task duration thresholds (e.g., 2.5, 10, 37.5, 120, 360 minutes)</li>
                    <li><strong>w<sub>i</sub>:</strong> Task bucket weights (sum to 1.0, e.g., 25%, 35%, 25%, 10%, 5%)</li>
                    <li><strong>s:</strong> Logistic softness (0.45 default, controls gate steepness)</li>
                    <li><strong>h<sub>AI</sub>:</strong> Max annual hazard (0.50 = 50% per year at full automation)</li>
                    <li><strong>:</strong> Hazard steepness (8.0 default, controls S-curve sharpness)</li>
                    <li><strong><sub>0</sub>:</strong> Readiness threshold (0.50 = automation kicks in at 50% task coverage)</li>
                    <li><strong>userMult:</strong> Question-based multiplier (bounded 0.5 to 2.0)</li>
                </ul>

                <h4 style="color: #2a5298; margin: 30px 0 15px 0; font-size: 1.1em;">Risk Curves: Blue vs Green</h4>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                    <div class="equation-callout">
                        <span class="callout-label">Blue Curve (Technical Feasibility)</span>
                        <div class="equation-display">$$P_{\text{tech}}(t) = 1 - \exp\left(-\int_0^t \lambda_{\text{AI}}(u) \, du\right)$$</div>
                    </div>

                    <div class="equation-callout">
                        <span class="callout-label">Green Curve (Actual Job Loss)</span>
                        <div class="equation-display">$$P_{\text{actual}}(t) = P_{\text{tech}}(t - \Delta), \quad \Delta = \text{implementation delay}$$</div>
                    </div>
                </div>

                <p><strong>Key insight:</strong> The Green curve is <em>not</em> a separate hazard-it's the Blue curve shifted right by implementation delay (). Blue represents when AI <em>can</em> technically do the job; Green represents when organizations <em>actually</em> adopt automation, accounting for regulatory friction, labor protections, integration costs, and trust requirements.</p>

                <h4 style="color: #2a5298; margin: 30px 0 15px 0; font-size: 1.1em;">Model Defaults</h4>

                <ul class="factor-grid factor-grid--compact">
                    <li><strong>H<sub>50,0</sub>:</strong> 50 minutes (baseline task time, March 2025)</li>
                    <li><strong>D:</strong> 7 months (METR doubling period)</li>
                    <li><strong>r:</strong> 0.95 (95% reliability target)</li>
                    <li><strong>Task buckets:</strong> &lt;5m: 25%, 5-15m: 35%, 15-60m: 25%, 1-3h: 10%, &gt;3h: 5%</li>
                    <li><strong>s:</strong> 0.45 (logistic softness)</li>
                    <li><strong><sub>0</sub>:</strong> 0.50 (50% readiness threshold)</li>
                    <li><strong>:</strong> 8.0 (hazard gate steepness)</li>
                    <li><strong>h<sub>AI</sub>:</strong> 0.50 yr<sup>-1</sup> (max 50% annual hazard)</li>
                    <li><strong>userMult range:</strong> 0.5 (max protection from unions/trust/liability) to 2.0 (max acceleration)</li>
                </ul>

                <p><strong>Question effects:</strong> Explicit vs. implicit task mix modifies bucket weights (w<sub>i</sub>) and softness (s). Union strength, trust requirements, and liability concerns move implementation delay () rather than amplifying hazard directly, since these are adoption barriers, not capability limits. Major protective factors shift <sub>0</sub> higher (AI must master more tasks before displacement begins).</p>
            </section>
                </div>
            </div>
        </div>
    </div>

    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" async></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let selectedRole = null;
        let currentParams = null;
        let chart = null;

        const baseDoublingMonths = 7;
        const deltaTacit = 0.07;
        const computeSliderBaseline = 3.4;
        const domainPaceSliderBaseline = 1.0;

        // METR-based capability model parameters
        const METR_DEFAULTS = {
            H50_0: 50,              // Baseline 50% task completion time in minutes
            D_months: 7,            // METR doubling time in months
            r_target: 0.95,         // Reliability target (95%)
            softness: 0.45,         // Logistic softness parameter [0.35, 0.6]
            // Task duration buckets (minutes) and weights (sum to 1.0)
            taskBuckets: [
                { L: 2.5, w: 0.25 },    // <5min tasks
                { L: 10, w: 0.35 },     // 5-15min tasks
                { L: 37.5, w: 0.25 },   // 15-60min tasks
                { L: 120, w: 0.10 },    // 1-3hr tasks
                { L: 360, w: 0.05 }     // >3hr tasks
            ]
        };

        const SENIORITY_PROFILES = [
            { label: 'Entry', thetaLift: 0.00, hazardShield: 0.00, delayShift: 0.0, reemploymentBoost: 1.00 },
            { label: 'Mid-Level', thetaLift: 0.00, hazardShield: 0.00, delayShift: 0.4, reemploymentBoost: 1.03 },
            { label: 'Senior', thetaLift: 0.00, hazardShield: 0.00, delayShift: 0.8, reemploymentBoost: 1.06 },
            { label: 'Lead/Principal', thetaLift: 0.00, hazardShield: 0.00, delayShift: 1.2, reemploymentBoost: 1.08 },
            { label: 'Executive', thetaLift: 0.00, hazardShield: 0.00, delayShift: 1.6, reemploymentBoost: 1.10 }
        ];

        // Seniority-based task weight shifts (shift toward longer tasks for higher levels)
        // DISABLED: All zeroed to ensure seniority only affects green curve (implementation delay)
        const SENIORITY_TASK_SHIFTS = [
            [ 0.00,  0.00,  0.00, +0.00, +0.00],  // Entry
            [ 0.00,  0.00,  0.00, +0.00, +0.00],  // Mid
            [ 0.00,  0.00,  0.00, +0.00, +0.00],  // Senior
            [ 0.00,  0.00,  0.00, +0.00, +0.00],  // Lead
            [ 0.00,  0.00,  0.00, +0.00, +0.00]   // Exec
        ];

        // Get task weights for a given seniority level (1-5)
        function getTaskWeightsForSeniority(level) {
            const baseWeights = METR_DEFAULTS.taskBuckets.map(b => b.w);
            const idx = Math.max(0, Math.min(SENIORITY_TASK_SHIFTS.length - 1, level - 1));
            const shift = SENIORITY_TASK_SHIFTS[idx];
            const adjusted = baseWeights.map((w, i) => w + shift[i]);
            const sum = adjusted.reduce((a, b) => a + b, 0);
            return adjusted.map(w => w / sum);  // Normalize
        }

        // Get softness parameter for a given seniority level
        // FIXED: Now constant across all levels to ensure seniority only affects green curve
        function getSoftnessForSeniority(level) {
            return 0.45;  // Constant for all seniority levels
        }

        const THETA_BASE_ENTRY = 0.50;

        function clamp(value, min = 0, max = 1) {
            return Math.min(max, Math.max(min, value));
        }

        function toScore(raw) {
            if (typeof raw !== 'number' || Number.isNaN(raw)) return 2;
            if (raw >= 1 && raw <= 5) {
                return Math.max(0, Math.min(4, raw - 1));
            }
            return Math.max(0, Math.min(4, raw));
        }

        function norm(value) {
            return clamp(toScore(value) / 4, 0, 1);
        }

        function avg(questionKeys, answers) {
            if (!Array.isArray(questionKeys) || questionKeys.length === 0) {
                return 2;
            }
            const total = questionKeys.reduce((sum, key) => {
                const val = answers && typeof answers[key] === 'number' ? answers[key] : 3;
                return sum + toScore(val);
            }, 0);
            return total / questionKeys.length;
        }

        function inferredExplicitness(answers) {
            // TODO: wire to questionnaire state once answers persist outside analyzeRole
            const sPos = avg(['Q1', 'Q3', 'Q4', 'Q5', 'Q6', 'Q8'], answers);
            const sNeg = avg(['Q7', 'Q9'], answers);
            return clamp(0.65 * norm(sPos) - 0.35 * norm(sNeg) + 0.10, 0, 1);
        }

        function inferredFrictionDecay(answers) {
            // TODO: wire to questionnaire state once answers persist outside analyzeRole
            const get = (key) => (answers && typeof answers[key] === 'number') ? answers[key] : 3;
            let lam = 0.02;
            lam += 0.01 * (norm(get('Q13')) - 0.5);
            lam += 0.01 * (norm(get('Q16')) - 0.5);
            lam += 0.005 * (norm(get('Q14')) - 0.5);
            lam += 0.005 * (norm(get('Q15')) - 0.5);
            lam -= 0.01 * (norm(get('Q11')) - 0.5);
            lam -= 0.01 * (norm(get('Q10')) - 0.5);
            return clamp(lam, 0.005, 0.05);
        }

        function inferredPace(answers) {
            // Map questionnaire responses into a METR pace multiplier.
            const get = (key) => (answers && typeof answers[key] === 'number') ? answers[key] : 3;
            const normDiff = (key) => norm(get(key)) - 0.5;

            let pace = 1.0;

            const acceleratorWeights = {
                Q2: 0.20,   // Data availability accelerates when high
                Q6: 0.10,   // Standardized workflows accelerate automation
                Q8: 0.10,   // Fast feedback loops accelerate iteration
                Q13: 0.15,  // Company adoption culture accelerates
                Q16: 0.15   // Strong IT infrastructure accelerates
            };

            const frictionWeights = {
                Q7: 0.18,   // Context dependence slows automation when high
                Q9: 0.20,   // Tacit knowledge slows transfer
                Q10: 0.24,  // Relationship-heavy work slows automation
                Q11: 0.28,  // Physical presence needs slow automation
                Q12: 0.16   // Trust/compliance requirements slow adoption
            };

            for (const [key, weight] of Object.entries(acceleratorWeights)) {
                pace -= weight * normDiff(key);
            }

            for (const [key, weight] of Object.entries(frictionWeights)) {
                pace += weight * normDiff(key);
            }

            return clamp(pace, 0.5, 2.0);
        }

        function resolvedComputeMultiplier() {
            const slider = document.getElementById('compute-scaling');
            // Slider represents annual compute growth (1.5 to 5, default 3.4)
            // Higher value = faster compute growth = faster AI progress
            const sliderValue = slider ? parseFloat(slider.value) : computeSliderBaseline;
            // Invert: higher compute growth should DIVIDE doubling time (faster progress)
            // Formula: baseline / sliderValue ensures default (3.4) returns 1.0
            const inverted = computeSliderBaseline / sliderValue;
            const base = currentParams && typeof currentParams.computeMultiplier === 'number'
                ? currentParams.computeMultiplier
                : 1.0;
            return base * inverted;
        }

        function resolvedDomainPace() {
            const slider = document.getElementById('industry-pace');
            // Slider now represents friction (0.5 to 2.0, default 1.0)
            // Higher friction = slower automation
            const frictionValue = slider ? parseFloat(slider.value) : domainPaceSliderBaseline;
            const normalized = frictionValue / domainPaceSliderBaseline;
            const base = currentParams && typeof currentParams.domainPace === 'number'
                ? currentParams.domainPace
                : 1.0;
            const combined = base * normalized;
            return clamp(combined, 0.4, 3.0);
        }

        function resolvedReliabilityTarget() {
            const slider = document.getElementById('ai-reliability');
            if (slider) {
                const percentValue = parseInt(slider.value); // 50-99
                return percentValue / 100.0; // Convert to 0.50-0.99
            }
            return METR_DEFAULTS.r_target; // Default 0.95
        }

        function resolvedBaseDoublingMonths() {
            const slider = document.getElementById('ai-doubling');
            if (slider) {
                const raw = parseFloat(slider.value);
                if (!Number.isNaN(raw)) {
                    return raw;
                }
            }
            if (currentParams && typeof currentParams.doublingMonths === 'number') {
                return currentParams.doublingMonths;
            }
            return baseDoublingMonths;
        }

        // METR-based capability functions

        // Reliability adjustment factor fitted to METR empirical data
        // METR shows p50/p80  5.54 across models, which gives exponent k  -3.643
        // Formula: f(r) = (0.50/r)^k where k = log(5.54) / log(0.50/0.80)
        // Results: f(0.50)=1.0, f(0.80)=5.54 (METR), f(0.95)=10.36, f(0.99)=12.04
        function reliabilityFactor(r) {
            const k = -3.643; // Fitted to METR p50/p80 ratio
            return Math.pow(0.50 / r, k);
        }

        // METR capability: H_r(t) = (H50_0 * f(r)) / 2^(months_elapsed / D_eff)
        // Returns task completion time in minutes at time t (years)
        // FIXED: Now multiplies H50_0 by f(r) to stretch requirement (higher reliability  higher requirement)
        function H_r(tYears, H50_0 = METR_DEFAULTS.H50_0, r = null) {
            const D_months = resolvedBaseDoublingMonths();
            const computeFriction = resolvedComputeMultiplier();  // Now represents friction/barriers
            const industryFriction = resolvedDomainPace();  // Now represents friction
            const reliability = r !== null ? r : resolvedReliabilityTarget(); // Use slider if r not provided

            // Effective doubling time: MULTIPLY by frictions (higher friction  longer doubling  slower automation)
            const D_eff = D_months * computeFriction * industryFriction;

            // Debug logging (only log occasionally to avoid spam)
            if (tYears === 0 && Math.random() < 0.1) {
                console.log('[H_r] D_months:', D_months, 'computeFriction:', computeFriction.toFixed(2),
                           'industryFriction:', industryFriction.toFixed(2), ' D_eff:', D_eff.toFixed(2), 'months',
                           'reliability:', (reliability * 100).toFixed(0) + '%');
            }

            const monthsElapsed = tYears * 12;
            const progress = Math.pow(2, monthsElapsed / D_eff);
            const f_r = reliabilityFactor(reliability);

            // Note: Higher capability means LOWER task time
            const domainPenalty = currentParams && typeof currentParams.domainPenalty === 'number'
                ? currentParams.domainPenalty
                : 1.0;
            const baselineMinutes = H50_0 * domainPenalty;  // Domain mismatch stretches METR baseline
            return (baselineMinutes * f_r) / progress;
        }

        // Logistic gate for single task bucket: G(H, L_i, s) = 1 / (1 + exp(-(ln(L_i) - ln(H)) / s))
        // Returns probability that AI can complete tasks of duration L_i given current capability H
        // FIXED: Now uses ln(L) - ln(H) so faster AI (lower H)  higher readiness
        function taskGate(H, L, s = METR_DEFAULTS.softness) {
            const logH = Math.log(Math.max(0.01, H));  // Prevent log(0)
            const logL = Math.log(L);
            const exponent = -(logL - logH) / s;  // FIXED: Reversed to ln(L) - ln(H)
            return 1.0 / (1.0 + Math.exp(exponent));
        }

        // AI Readiness: A(t) =  w_i * G(H_r(t), L_i, s)
        // Returns value in [0, 1] representing fraction of job tasks AI can perform
        // UPDATED: Now uses seniority-based task weights and softness
        function A_job(tYears) {
            const H = H_r(tYears);
            const buckets = METR_DEFAULTS.taskBuckets;

            // Get seniority level from currentParams (default to entry level)
            const seniorityLevel = (currentParams && currentParams.seniority) || 1;
            const weights = getTaskWeightsForSeniority(seniorityLevel);
            const s = getSoftnessForSeniority(seniorityLevel);

            let readiness = 0;
            for (let i = 0; i < buckets.length; i++) {
                readiness += weights[i] * taskGate(H, buckets[i].L, s);
            }

            // Ensure bounded [0, 1]
            return Math.max(0, Math.min(1, readiness));
        }

        // Legacy compatibility functions (kept for now but unused)
        function dEff() {
            const computeMultiplier = resolvedComputeMultiplier();
            const domainPace = resolvedDomainPace();
            const doublingMonths = resolvedBaseDoublingMonths();
            return doublingMonths / (computeMultiplier * domainPace);
        }

        function A_explicit(tYears) {
            return Math.pow(2, tYears / (dEff() / 12));
        }

        function A_tacit(tYears) {
            return 1 + deltaTacit * tYears;
        }

        // METR model acceptance tests
        function runMETRAcceptanceTests() {
            console.log('\n=== METR MODEL ACCEPTANCE TESTS ===\n');

            // Test 1: A(t) is bounded [0,1]
            console.log('TEST 1: A(t) bounded [0,1]');
            const testTimes = [0, 1, 2, 3, 5, 10, 15, 20];
            let allBounded = true;
            testTimes.forEach(t => {
                const A_t = A_job(t);
                const bounded = A_t >= 0 && A_t <= 1;
                console.log(`  A(${t}yr) = ${A_t.toFixed(4)} ${bounded ? '' : ' OUT OF BOUNDS'}`);
                if (!bounded) allBounded = false;
            });
            console.log(`  RESULT: ${allBounded ? 'PASS ' : 'FAIL '}\n`);

            // Test 2: Increasing r shifts milestones later
            console.log('TEST 2: Increasing r  later milestones');
            const findMilestone = (r_val, targetProb = 0.5) => {
                // Temporarily override reliability
                const origA = A_job;
                window.A_job = function(tYears) {
                    const H = H_r(tYears, METR_DEFAULTS.H50_0, r_val);
                    const buckets = METR_DEFAULTS.taskBuckets;
                    const s = METR_DEFAULTS.softness;
                    let readiness = 0;
                    for (const bucket of buckets) {
                        readiness += bucket.w * taskGate(H, bucket.L, s);
                    }
                    return Math.max(0, Math.min(1, readiness));
                };

                let low = 0, high = 50;
                while (high - low > 0.1) {
                    const mid = (low + high) / 2;
                    const prob = calculateDisplacementProbability(mid);
                    if (prob < targetProb) low = mid;
                    else high = mid;
                }
                window.A_job = origA;
                return (low + high) / 2;
            };

            const milestone_r90 = findMilestone(0.90);
            const milestone_r95 = findMilestone(0.95);
            const milestone_r99 = findMilestone(0.99);
            console.log(`  50% milestone at r=0.90: ${milestone_r90.toFixed(2)} years`);
            console.log(`  50% milestone at r=0.95: ${milestone_r95.toFixed(2)} years`);
            console.log(`  50% milestone at r=0.99: ${milestone_r99.toFixed(2)} years`);
            const shiftCorrect = milestone_r99 > milestone_r95 && milestone_r95 > milestone_r90;
            console.log(`  RESULT: ${shiftCorrect ? 'PASS ' : 'FAIL '}\n`);

            // Test 3: Decreasing D_months shifts earlier
            console.log('TEST 3: Decreasing D_months  earlier milestones');
            console.log('  (Tested via slider - lower doubling = earlier automation)\n');

            // Test 4: Blue and Green curves identical except for delay
            console.log('TEST 4: Green = Blue shifted by delay');
            console.log('  Green curve at t=T should equal Blue curve at t=(T-delay)');
            console.log('  This is enforced by updateChart() implementation \n');

            // Test 5: Key diagnostic values
            console.log('DIAGNOSTIC VALUES:');
            console.log(`  H_r(0) = ${H_r(0).toFixed(2)} minutes (baseline capability)`);
            console.log(`  H_r(5) = ${H_r(5).toFixed(4)} minutes (more capable  lower time)`);
            console.log(`  A(0) = ${A_job(0).toFixed(4)} (should be near 0)`);
            console.log(`  A(5) = ${A_job(5).toFixed(4)} (should be in [0,1])`);
            console.log(`  reliability factor f(0.95) = ${reliabilityFactor(0.95).toFixed(4)}`);

            console.log('\n=== END ACCEPTANCE TESTS ===\n');
        }

        // Unit tests to guard against regressions from patch
        function runRegressionTests() {
            console.log('\n=== REGRESSION GUARD TESTS (PATCH) ===\n');

            let allPassed = true;

            // Test 1: Gate direction - faster AI (lower H) should give higher readiness
            console.log('TEST 1: Gate direction');
            const s = 0.45, L = 10;
            const gateFast = taskGate(1, L, s);
            const gateSlow = taskGate(100, L, s);
            const gatePass = gateFast > gateSlow;
            console.log(`  taskGate(H=1, L=10) = ${gateFast.toFixed(4)}`);
            console.log(`  taskGate(H=100, L=10) = ${gateSlow.toFixed(4)}`);
            console.log(`  RESULT: ${gatePass ? 'PASS ' : 'FAIL '} (faster AI must have higher readiness)`);
            if (!gatePass) allPassed = false;

            // Test 2: Reliability factor - r=0.95 should be ~13.5, r=0.99 should be ~69-72
            console.log('\nTEST 2: Reliability factor');
            const f95 = reliabilityFactor(0.95);
            const f99 = reliabilityFactor(0.99);
            const reliabilityPass = (f95 > 10 && f95 < 16) && (f99 > 65 && f99 < 75);
            console.log(`  f(0.95) = ${f95.toFixed(2)} (expected ~13.5)`);
            console.log(`  f(0.99) = ${f99.toFixed(2)} (expected ~69-72)`);
            console.log(`  RESULT: ${reliabilityPass ? 'PASS ' : 'FAIL '}`);
            if (!reliabilityPass) allPassed = false;

            // Test 3: Green curve clamp - should never sample negative time
            console.log('\nTEST 3: Green curve clamp');
            const delay = 2;
            const blueCurve = (t) => (t <= 0 ? 0 : Math.min(t / 4, 1));
            const greenAt1 = 1 >= delay ? blueCurve(1 - delay) : 0;
            const clampPass = greenAt1 === 0;
            console.log(`  Green(t=1) with delay=2 should = Blue(max(1-2, 0)) = Blue(0) = 0`);
            console.log(`  Actual: ${greenAt1}`);
            console.log(`  RESULT: ${clampPass ? 'PASS ' : 'FAIL '}`);
            if (!clampPass) allPassed = false;

            // Test 4: Seniority task weight shift - Executive should shift to longer tasks
            console.log('\nTEST 4: Seniority weight shift');
            const baseWeights = METR_DEFAULTS.taskBuckets.map(b => b.w);
            const execWeights = getTaskWeightsForSeniority(5);  // Executive
            const shiftPass = execWeights[3] > baseWeights[3] &&
                             execWeights[0] < baseWeights[0] &&
                             execWeights[1] < baseWeights[1];
            console.log(`  Base weights (Entry): [${baseWeights.map(w => w.toFixed(2)).join(', ')}]`);
            console.log(`  Exec weights: [${execWeights.map(w => w.toFixed(2)).join(', ')}]`);
            console.log(`  RESULT: ${shiftPass ? 'PASS ' : 'FAIL '} (Exec shifts weight to longer tasks)`);
            if (!shiftPass) allPassed = false;

            // Test 5: Doubling dynamics - progress should double in 7 months
            console.log('\nTEST 5: Doubling dynamics');
            const D = 7;
            const months = 7;
            const progress = Math.pow(2, months / D);
            const doublingPass = Math.abs(progress - 2) < 1e-6;
            console.log(`  Progress after 7 months with D=7: ${progress.toFixed(6)}`);
            console.log(`  RESULT: ${doublingPass ? 'PASS ' : 'FAIL '} (should be exactly 2.0)`);
            if (!doublingPass) allPassed = false;

            console.log(`\n=== OVERALL: ${allPassed ? 'ALL TESTS PASSED ' : 'SOME TESTS FAILED '} ===\n`);
        }

        // WWILMJ PATCH: Regression tests to verify slider direction and weight normalization
        function runPatchRegressionTests() {
            console.log('\n=== WWILMJ PATCH REGRESSION TESTS ===\n');

            let allPassed = true;

            // Helper: Create neutral answers (all 3s)
            const neutralAnswers = {};
            for (let i = 1; i <= 20; i++) neutralAnswers[`Q${i}`] = 3;

            // Test 1: Q5 direction - moving from 15 should INCREASE hazardMult
            console.log('TEST 1: Q5 direction (decomposability)');
            const q5Low = { ...neutralAnswers, Q5: 1 };  // Very Complex
            const q5High = { ...neutralAnswers, Q5: 5 }; // Highly Structured
            const { ampMult: ampQ5Low, fricMult: fricQ5Low } = computeHazardMultipliers(q5Low);
            const { ampMult: ampQ5High, fricMult: fricQ5High } = computeHazardMultipliers(q5High);
            const multQ5Low = ampQ5Low * fricQ5Low;
            const multQ5High = ampQ5High * fricQ5High;
            const q5Pass = multQ5High > multQ5Low;
            console.log(`  Q5=1 (complex): hazardMult = ${multQ5Low.toFixed(3)}`);
            console.log(`  Q5=5 (structured): hazardMult = ${multQ5High.toFixed(3)}`);
            console.log(`  RESULT: ${q5Pass ? 'PASS ' : 'FAIL '} (moving 15 should increase hazard)`);
            if (!q5Pass) allPassed = false;

            // Test 2: Q11 direction - moving from 15 should DECREASE hazardMult
            console.log('\nTEST 2: Q11 direction (physical presence)');
            const q12Low = { ...neutralAnswers, Q11: 1 };  // None
            const q12High = { ...neutralAnswers, Q11: 5 }; // Essential
            const { ampMult: ampQ12Low, fricMult: fricQ12Low } = computeHazardMultipliers(q12Low);
            const { ampMult: ampQ12High, fricMult: fricQ12High } = computeHazardMultipliers(q12High);
            const multQ12Low = ampQ12Low * fricQ12Low;
            const multQ12High = ampQ12High * fricQ12High;
            const q12Pass = multQ12High < multQ12Low;
            console.log(`  Q11=1 (none): hazardMult = ${multQ12Low.toFixed(3)}`);
            console.log(`  Q11=5 (essential): hazardMult = ${multQ12High.toFixed(3)}`);
            console.log(`  RESULT: ${q12Pass ? 'PASS ' : 'FAIL '} (moving 15 should decrease hazard)`);
            if (!q12Pass) allPassed = false;

            // Test 3: Q15 direction - moving from 15 should INCREASE delayYears
            console.log('\nTEST 3: Q15 direction (labor market tightness)');
            const q16Easy = { ...neutralAnswers, Q15: 1 };       // Very Easy to hire
            const q16Difficult = { ...neutralAnswers, Q15: 5 };  // Very Difficult to hire
            const delayEasy = calculateImplementationDelay(q16Easy, 1);
            const delayDifficult = calculateImplementationDelay(q16Difficult, 1);
            const q16Pass = delayDifficult > delayEasy;
            console.log(`  Q15=1 (easy to hire): delay = ${delayEasy.toFixed(2)} years`);
            console.log(`  Q15=5 (difficult to hire): delay = ${delayDifficult.toFixed(2)} years`);
            console.log(`  RESULT: ${q16Pass ? 'PASS ' : 'FAIL '} (moving 15 should increase delay)`);
            if (!q16Pass) allPassed = false;

            // Test 4: Calibration - Max(Q1,Q4,Q6)=5 vs all=3 should yield 2.5 hazard
            console.log('\nTEST 4: High-risk amplifier stack (Q1+Q4+Q6 max)');
            const maxRiskAnswers = { ...neutralAnswers, Q1: 5, Q4: 5, Q6: 5 };
            const { ampMult: neutralAmp, fricMult: neutralFric } = computeHazardMultipliers(neutralAnswers);
            const { ampMult: maxAmp, fricMult: maxFric } = computeHazardMultipliers(maxRiskAnswers);
            const neutralMult = neutralAmp * neutralFric;
            const maxMult = maxAmp * maxFric;
            const multRatio = maxMult / neutralMult;
            const calibPass = multRatio >= 2.5;
            console.log(`  Neutral (all 3s): hazardMult = ${neutralMult.toFixed(3)}`);
            console.log(`  Max risk (Q1,Q4,Q6=5): hazardMult = ${maxMult.toFixed(3)}`);
            console.log(`  Ratio: ${multRatio.toFixed(2)}`);
            console.log(`  RESULT: ${calibPass ? 'PASS ' : 'FAIL '} (should be 2.5)`);
            if (!calibPass) allPassed = false;

            // Test 5: Protective stack - Q7=5, Q9=5, Q11=5, Q15=5 should suppress hazard 0.5 AND increase delay 0.7y
            console.log('\nTEST 5: Protective stack (Q7+Q9+Q11 high friction, Q15 high)');
            const protectiveAnswers = { ...neutralAnswers, Q7: 5, Q9: 5, Q11: 5, Q15: 5 };
            const { ampMult: protAmp, fricMult: protFric } = computeHazardMultipliers(protectiveAnswers);
            const protMult = protAmp * protFric;
            const protRatio = protMult / neutralMult;
            const neutralDelay = calculateImplementationDelay(neutralAnswers, 1);
            const protDelay = calculateImplementationDelay(protectiveAnswers, 1);
            const delayIncrease = protDelay - neutralDelay;
            const protPass = protRatio <= 0.5 && delayIncrease >= 0.7;
            console.log(`  Protective stack: hazardMult = ${protMult.toFixed(3)} (ratio: ${protRatio.toFixed(2)})`);
            console.log(`  Neutral delay: ${neutralDelay.toFixed(2)}y, Protective delay: ${protDelay.toFixed(2)}y`);
            console.log(`  Delay increase: ${delayIncrease.toFixed(2)}y`);
            console.log(`  RESULT: ${protPass ? 'PASS ' : 'FAIL '} (hazard 0.5 AND delay +0.7y)`);
            if (!protPass) allPassed = false;

            // Test 6: Q1 minmax swing should produce 12pp increase in 2030 risk
            console.log('\nTEST 6: Q1 swing impact on 2030 risk');
            // Helper to compute risk by 2030
            const computeRisk2030 = (answers) => {
                const { ampMult, fricMult } = computeHazardMultipliers(answers);
                const mismatch = computeDomainMismatch(answers);
                const savedParams = currentParams;
                currentParams = {
                    h0: 0.015, theta: 0.50, gamma: 1.2, kappa: 0.3, friction: 3.0,
                    seniority: 1, seniorityProfile: SENIORITY_PROFILES[0],
                    s_e: inferredExplicitness(answers), lambda: inferredFrictionDecay(answers),
                    domainPace: inferredPace(answers), computeMultiplier: 1.0,
                    doublingMonths: baseDoublingMonths, ampMult: ampMult, fricMult: fricMult,
                    domainPenalty: mismatch.penalty, domainAlignment: mismatch.alignment,
                    answers: answers, implementationDelay: 0
                };
                const risk = calculateDisplacementProbability(5.35);
                currentParams = savedParams;
                return risk;
            };
            const q1Min = { ...neutralAnswers, Q1: 1 };
            const q1Max = { ...neutralAnswers, Q1: 5 };
            const riskQ1Min = computeRisk2030(q1Min);
            const riskQ1Max = computeRisk2030(q1Max);
            const q1Delta = (riskQ1Max - riskQ1Min) * 100;
            const q1SwingPass = q1Delta >= 12;
            console.log(`  Q1=1: 2030 risk = ${(riskQ1Min * 100).toFixed(1)}%`);
            console.log(`  Q1=5: 2030 risk = ${(riskQ1Max * 100).toFixed(1)}%`);
            console.log(`  Delta: ${q1Delta.toFixed(1)}pp`);
            console.log(`  RESULT: ${q1SwingPass ? 'PASS ' : 'FAIL '} (should be 12pp)`);
            if (!q1SwingPass) allPassed = false;

            console.log(`\n=== PATCH TESTS: ${allPassed ? 'ALL PASSED ' : 'SOME FAILED '} ===\n`);
            return allPassed;
        }

        // Tests will be run after DOM is ready (see DOMContentLoaded handler below)
        document.querySelectorAll('.preset-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                selectedRole = this.dataset.role;

                const customInput = document.getElementById('custom-role');
                if (selectedRole === 'custom') {
                    customInput.style.display = 'block';
                } else {
                    customInput.style.display = 'none';
                }

                analyzeRole();
            });
        });

        // Add event listeners to all radio buttons to auto-update
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', function() {
                analyzeRole();
            });
        });

        function getQuestionValue(questionNum) {
            const checked = document.querySelector(`input[name="q${questionNum}"]:checked`);
            return checked ? parseFloat(checked.value) : 3;
        }

        // Per-question log-hazard multipliers for TECHNICAL FEASIBILITY (Blue Curve)
        // ONLY factors that determine when AI CAN technically do the job
        // All sliders: 12, 30, 5+2 (coded uniformly). Direction comes from weight sign.
        const QUESTION_WEIGHTS = {
            // BLUE: Technical feasibility (amp increases risk, fric protects)
            Q1:  { amp: +0.80 },  // Current AI Performance
            Q2:  { amp: +0.40 },  // Data Availability
            Q3:  { amp: +0.35 },  // Benchmark Clarity
            Q4:  { amp: +0.55 },  // Task Digitization
            Q5:  { amp: +0.50 },  // Task Decomposability (FIXED: now amp+ channel)
            Q6:  { amp: +0.45 },  // Task Standardization
            Q7:  { fric: -0.50 }, // Context Dependency
            Q8:  { amp: +0.45 },  // Feedback Loop Speed
            Q9:  { fric: -0.40 }, // Tacit Knowledge
            Q10: { fric: -0.45 }, // Human Judgment & Relationships
            Q11: { fric: -0.60 }, // Physical Presence (FIXED: now fric channel)
            Q12: { fric: -0.35 }, // Trust Requirements
            // Q13-Q16: Company/Industry context - affects implementation delay only
            // Q17, Q19: Re-employment factors - affects job search success only
            // Q18, Q20: Job retention factors - affects implementation delay only
            // Q20: Also affects re-employment (dual purpose)
        };

        const DOMAIN_ALIGNMENT_WEIGHTS = {
            Q4: +0.28,  // Task digitization
            Q5: +0.24,  // Task decomposability
            Q6: +0.22,  // Task standardization
            Q7: -0.32,  // Context dependency
            Q9: -0.28,  // Tacit knowledge
            Q10: -0.34, // Human judgment & relationships
            Q11: -0.38, // Physical presence
            Q12: -0.24  // Trust and compliance load
        };

        function computeDomainMismatch(answers) {
            let weightedSum = 0;
            for (const [qid, weight] of Object.entries(DOMAIN_ALIGNMENT_WEIGHTS)) {
                const raw = answers && Object.prototype.hasOwnProperty.call(answers, qid) ? answers[qid] : 3;
                const x = codeAnswer(qid, raw);
                weightedSum += weight * x;
            }
            weightedSum = Math.max(-3.0, Math.min(3.0, weightedSum));
            const penalty = clamp(Math.exp(-weightedSum), 0.5, 3.0);
            const alignment = clamp(0.5 + 0.18 * weightedSum, 0, 1);
            return { penalty, alignment, weightedSum };
        }


        // Implementation delay weights - delays actual job loss from technical feasibility (Green Curve)
        // Formula: delay = 1.75 - (delayScore * 1.25)
        // To get MORE delay when value is LOW, we need POSITIVE weight (converts negative coded value to negative score)
        const IMPLEMENTATION_WEIGHTS = {
            // Company/Industry Context (Q13-Q16)
            Q13: +0.40,  // Company AI adoption: 1=Resistant (more delay), 5=Leading Edge (less delay)
            Q14: +0.30,  // Labor cost pressure: 1=Not Sensitive (more delay), 5=Extremely Sensitive (less delay)
            Q15: -0.35,  // Labor market tightness: 5=Very Difficult (more delay), 1=Very Easy (less delay)
            Q16: +0.35,  // IT infrastructure: 1=Very Outdated (more delay), 5=Cutting Edge (less delay)
            // Job Retention Factors (Q18, Q20)
            Q18: -0.25,  // AI complementarity: 5=Amplify Only (more delay), 1=Replace Only (less delay) - employer keeps you longer
            Q20: -0.35,  // Job performance: 5=Top 10% (more delay), 1=Below Average (less delay) - top performers retained longer
        };

        // Re-employment probability weights (Q17, Q19, Q20) - affects ability to find new job
        const REEMPLOYMENT_WEIGHTS = {
            Q17: +0.50,  // Skill transferability: 5=Highly Transferable (higher re-employment), 1=Highly Specific (lower)
            Q19: +0.50,  // Adaptability: 5=Very Fast (higher re-employment), 1=Very Slow (lower)
            Q20: +0.30,  // Job performance: 5=Top 10% (higher re-employment), 1=Below Average (lower re-employment)
        };

        // Code raw answers to numeric x_i, aiming for symmetric effects
        // Likert 1..5 -> -2..+2; booleans -> +/-1; fallback 0.
        function codeAnswer(qid, raw) {
            if (typeof raw === 'number' && raw >= 1 && raw <= 5) return raw - 3;
            if (raw === true) return +1;
            if (raw === false) return -1;
            return 0;
        }

        // Compute hazard multipliers from all answers
        function computeHazardMultipliers(answers) {
            let sumAmp = 0, sumFric = 0;
            for (const [qid, raw] of Object.entries(answers)) {
                const w = QUESTION_WEIGHTS[qid];
                if (!w) continue;
                const x = codeAnswer(qid, raw);
                if (w.amp)  sumAmp  += w.amp  * x;
                if (w.fric) sumFric += w.fric * x;
            }
            const clamp = (v, lo, hi) => Math.max(lo, Math.min(hi, v));
            sumAmp  = clamp(sumAmp,  -2.0, +2.0);  //  0.14 .. 7.4
            sumFric = clamp(sumFric, -2.0, +2.0);
            return { ampMult: Math.exp(sumAmp), fricMult: Math.exp(sumFric) };
        }

        // Calculate implementation delay in years (0.5 - 3 years), scaled by seniority
        function calculateImplementationDelay(answers, seniority, seniorityProfile = SENIORITY_PROFILES[seniority - 1] || SENIORITY_PROFILES[0]) {
            let delayScore = 0;
            for (const [qid, weight] of Object.entries(IMPLEMENTATION_WEIGHTS)) {
                const raw = answers[qid];
                const x = codeAnswer(qid, raw);
                delayScore += weight * x;
            }
            const clamp = (v, lo, hi) => Math.max(lo, Math.min(hi, v));
            delayScore = clamp(delayScore, -2.0, +2.0);
            let delay = 1.0 - (delayScore * 0.9);
            delay = Math.max(0.5, Math.min(3.0, delay));
            if (seniorityProfile) {
                delay += seniorityProfile.delayShift;
            }
            return Math.max(0.4, Math.min(4.0, delay));
        }

        // Calculate re-employment probability (0-1 scale)
        // Dependent on technical feasibility timing and seniority
        function calculateReemploymentProbability(answers, seniority, medianTechYears) {
            let reemployScore = 0;
            for (const [qid, weight] of Object.entries(REEMPLOYMENT_WEIGHTS)) {
                const raw = answers[qid];
                const x = codeAnswer(qid, raw);
                reemployScore += weight * x;
            }
            const clamp = (v, lo, hi) => Math.max(lo, Math.min(hi, v));
            reemployScore = clamp(reemployScore, -2.0, +2.0);

            // Base probability from adaptability factors
            let probability = 0.6 + (reemployScore * 0.2);

            // Penalize based on how soon automation happens (sooner = harder to find work)
            // If median is <3 years: -30%, 3-7 years: -15%, 7-12 years: -5%, >12 years: 0%
            let timingPenalty = 0;
            if (medianTechYears < 3) timingPenalty = 0.30;
            else if (medianTechYears < 7) timingPenalty = 0.15;
            else if (medianTechYears < 12) timingPenalty = 0.05;
            probability -= timingPenalty;

            const seniorityProfile = SENIORITY_PROFILES[seniority - 1] || SENIORITY_PROFILES[0];
            probability *= seniorityProfile.reemploymentBoost;

            return clamp(probability, 0.1, 0.85); // Cap at 85% - no one is guaranteed
        }

        // Optional timing shift via capability gate steepness k (affects BLUE curve only)
        function kEff(baseK, answers) {
            let sumK = 0;
            const K_WEIGHTS = {
                // Accelerators (higher = faster/earlier automation)
                Q1: +0.20, Q2: +0.10, Q3: +0.10, Q4: +0.15, Q8: +0.12,
                // Decelerators (higher = slower/later automation)
                Q5: -0.20, Q6: -0.20, Q7: -0.20, Q9: -0.15, Q10: -0.15, Q11: -0.15, Q12: -0.15
                // Q13-Q16: Company/Industry - affects GREEN curve only
                // Q17, Q19: Re-employment - affects re-employment metric only
                // Q18, Q20: Job retention - affects GREEN curve only (Q20 also affects re-employment)
            };
            for (const [qid, raw] of Object.entries(answers)) {
                const x = codeAnswer(qid, raw);
                if (K_WEIGHTS[qid]) sumK += K_WEIGHTS[qid] * x;
            }
            sumK = Math.max(-1.0, Math.min(+1.0, sumK));
            return baseK * Math.exp(sumK);
        }

        function analyzeRole() {
            if (!selectedRole) {
                return;
            }

            const roleName = selectedRole === 'custom' ?
                (document.getElementById('custom-role').value || 'Custom Role') :
                document.querySelector(`.preset-btn[data-role="${selectedRole}"]`).textContent.trim();

            // Collect all answers
            const answers = {};
            for (let i = 1; i <= 20; i++) {
                answers[`Q${i}`] = getQuestionValue(i);
            }

            // Get seniority level (1=Entry, 2=Mid, 3=Senior, 4=Lead, 5=Executive)
            const seniorityChecked = document.querySelector('input[name="seniority"]:checked');
            const seniority = seniorityChecked ? parseFloat(seniorityChecked.value) : 1;

            // Compute hazard multipliers from question weights
            const { ampMult, fricMult } = computeHazardMultipliers(answers);

            // Compute section scores for display purposes only (not used in hazard calculation)
            const aiReadiness = (getQuestionValue(1) + getQuestionValue(2) +
                                getQuestionValue(3) + getQuestionValue(4)) / 4;

            const taskAdapt = (getQuestionValue(5) + getQuestionValue(6) + getQuestionValue(7) +
                              getQuestionValue(8) + getQuestionValue(9)) / 5;

            const friction = (getQuestionValue(10) + getQuestionValue(11) +
                            getQuestionValue(12) + getQuestionValue(13)) / 4;

            const firmReadiness = (getQuestionValue(14) + getQuestionValue(15) +
                                  getQuestionValue(16) + getQuestionValue(17)) / 4;

            const personalAdapt = (getQuestionValue(18) + getQuestionValue(19) +
                                  getQuestionValue(20)) / 3;

            // Baseline parameters (will be modified by question multipliers)
            const h0_base = 0.015;
            const thetaBase = THETA_BASE_ENTRY;  // entry-level coverage bar ~94%
            const gamma = 1.2;  // Capability sensitivity to surplus
            const kappa = 0.3;  // Baseline friction damping retained for other multipliers
            const frictionValue = 3.0;

            const seniorityProfile = SENIORITY_PROFILES[seniority - 1] || SENIORITY_PROFILES[0];
            const theta = thetaBase + seniorityProfile.thetaLift;
            const thetaEffective = Math.max(0.4, Math.min(1.2, theta));

            const s_e = inferredExplicitness(answers);
            const lambda = inferredFrictionDecay(answers);
            const domainPace = inferredPace(answers);
            const { penalty: domainPenalty, alignment: domainAlignment } = computeDomainMismatch(answers);
            const doublingMonths = parseFloat(document.getElementById('ai-doubling').value) || baseDoublingMonths;

            // Apply optional timing shift (capability gate steepness adjustment)
            const gammaEffective = kEff(gamma, answers);

            // Calculate implementation delay (scaled by seniority)
            const implementationDelay = calculateImplementationDelay(answers, seniority, seniorityProfile);

            currentParams = {
                name: roleName,
                h0: h0_base,
                theta: thetaEffective,
                gamma: Math.max(0.8, Math.min(2.5, gammaEffective)),
                kappa: kappa,
                friction: frictionValue,
                seniority: seniority,
                seniorityLabel: seniorityProfile.label,
                seniorityProfile: seniorityProfile,
                s_e: s_e,
                lambda: lambda,
                domainPace: domainPace,
                domainPenalty: domainPenalty,
                domainAlignment: domainAlignment,
                computeMultiplier: 1.0,
                doublingMonths: Math.max(2, Math.min(24, doublingMonths)),
                aiReadiness: aiReadiness,
                taskAdapt: taskAdapt,
                friction_score: friction,
                firmReadiness: firmReadiness,
                personalAdapt: personalAdapt,
                ampMult: ampMult,
                fricMult: fricMult,
                answers: answers,
                implementationDelay: implementationDelay
            };
            document.getElementById('role-display').textContent = currentParams.name;
            document.getElementById('ai-readiness-display').textContent = 
                `${(aiReadiness * 20).toFixed(0)}/100`;
            document.getElementById('task-adapt-display').textContent = 
                `${((6 - taskAdapt) * 20).toFixed(0)}/100`;
            document.getElementById('friction-display').textContent = 
                `${(friction * 20).toFixed(0)}/100`;
            document.getElementById('firm-display').textContent =
                `${(firmReadiness * 20).toFixed(0)}/100`;
            document.getElementById('personal-display').textContent =
                `${(personalAdapt * 20).toFixed(0)}/100`;
            
            updatePersonalTimeline();
            initChart();
            updateChart();
        }

        function updatePersonalTimeline() {
            const timeline = document.getElementById('personal-timeline');
            const events = [];
            
            const risk25 = findYearForProbability(0.25, currentParams);
            const risk50 = findYearForProbability(0.5, currentParams);
            const risk75 = findYearForProbability(0.75, currentParams);
            const risk90 = findYearForProbability(0.9, currentParams);
            
            const currentYear = 2025.65;
            
            if (risk25 < 10) {
                events.push({
                    date: (currentYear + risk25).toFixed(1),
                    description: '25% risk AI can technically automate role'
                });
            }
            if (risk50 < 15) {
                events.push({
                    date: (currentYear + risk50).toFixed(1),
                    description: '50% risk AI can technically automate role'
                });
            }
            if (risk75 < 20) {
                events.push({
                    date: (currentYear + risk75).toFixed(1),
                    description: '75% risk AI can technically automate role'
                });
            }
            if (risk90 < 25) {
                events.push({
                    date: (currentYear + risk90).toFixed(1),
                    description: '90% risk AI can technically automate role'
                });
            }
            
            timeline.innerHTML = events.map(e => `
                <div class="timeline-event">
                    <span class="timeline-date">${e.date}</span>
                    <span class="timeline-description">${e.description}</span>
                </div>
            `).join('');
        }

        function resetAnalysis() {
            selectedRole = null;
            currentParams = null;
            document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
            // Reset to default checked values
            document.querySelectorAll('input[type="radio"][value="3"]').forEach(r => r.checked = true);
        }

        function initChart() {
            const ctx = document.getElementById('chart').getContext('2d');
            if (chart) chart.destroy();
            
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Technical Feasibility of Automation',
                        data: [],
                        borderColor: '#2a5298',
                        backgroundColor: 'rgba(42, 82, 152, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Actual Job Loss',
                        data: [],
                        borderColor: '#22c55e',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${(context.parsed.y * 100).toFixed(1)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Years from Now'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Probability'
                            },
                            min: 0,
                            max: 1,
                            ticks: {
                                callback: function(value) {
                                    return (value * 100).toFixed(0) + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Compute user multipliers from questions (bounded to 0.33x - 3.0x overall)
        // PATCH: Apply seniority AFTER question product (hazardMult *= (1 - hazardShield))
        // PATCH: Widened from [0.5, 2.0] to [0.33, 3.0] to eliminate dead zones
        function getUserMultiplier() {
            if (!currentParams) return 1.0;

            // Step 1: Compute question-based hazard multiplier (ampMult * fricMult)
            const questionMultiplier = currentParams.ampMult * currentParams.fricMult;

            // Step 2: Apply seniority hazard shield AFTER question multiplier
            const profiles = SENIORITY_PROFILES;
            const idx = Math.max(0, Math.min(profiles.length - 1, (currentParams.seniority || 1) - 1));
            const profile = profiles[idx] || profiles[0];
            const hazardMult = questionMultiplier * (1 - (profile.hazardShield || 0));

            // Step 3: Bound overall multiplier to [0.33, 3.0] (wider band for better slider responsiveness)
            return Math.max(0.33, Math.min(3.0, hazardMult));
        }

        // New logistic gate hazard: lambdaAI(t) = hAI / (1 + exp(-gamma * (A(t) - theta)))
        // No internal time decay (removed e^(-lambda*t))
        // UPDATED: Now uses seniority-based theta (base _0 + thetaLift)
        function hazardAI(tYears) {
            if (!currentParams) return 0;

            const hAI = 0.50;           // Max annual hazard (50% per year at full automation)
            const gamma = 8.0;          // Steepness of logistic gate

            const seniorityLevel = currentParams.seniority || 1;
            const idx = Math.max(0, Math.min(SENIORITY_PROFILES.length - 1, seniorityLevel - 1));
            const profile = SENIORITY_PROFILES[idx];
            const thetaCandidate = typeof currentParams.theta === 'number'
                ? currentParams.theta
                : 0.50 + profile.thetaLift;
            const theta = Math.max(0.4, Math.min(1.2, thetaCandidate));

            const A_t = A_job(tYears);
            const logisticArg = -gamma * (A_t - theta);
            const baseHazard = hAI / (1.0 + Math.exp(logisticArg));

            const userMult = getUserMultiplier();
            const hazard = baseHazard * userMult;

            return Math.min(0.95, hazard);
        }

        // Legacy function kept for backward compatibility
        function otherFrictionMultipliers(tYears) {
            return getUserMultiplier();
        }

        // Cumulative risk from hazard series using survival function
        function cumulativeRiskFromHazard(hSeries, dtYears) {
            let cum = 0;
            return hSeries.map(h => {
                cum += h * dtYears;
                return 1 - Math.exp(-cum);
            });
        }

        // Calibration tests - run these to verify question weights have expected impact
        function runCalibrationTests() {
            const tests = [];

            // Helper to compute risk by 2030 (t=5.35 years from 2024.65)
            const computeRisk2030 = (answers) => {
                const { ampMult, fricMult } = computeHazardMultipliers(answers);
                const mismatch = computeDomainMismatch(answers);
                const savedParams = currentParams;
                currentParams = {
                    h0: 0.015,
                    theta: 0.50,
                    gamma: 1.2,
                    kappa: 0.3,
                    friction: 3.0,
                    seniority: 1,
                    s_e: inferredExplicitness(answers),
                    lambda: inferredFrictionDecay(answers),
                    domainPace: inferredPace(answers),
                    computeMultiplier: 1.0,
                    doublingMonths: baseDoublingMonths,
                    ampMult: ampMult,
                    fricMult: fricMult,
                    domainPenalty: mismatch.penalty,
                    domainAlignment: mismatch.alignment
                };
                const risk = calculateDisplacementProbability(5.35);
                currentParams = savedParams;
                return risk;
            };

            // Neutral baseline: all answers = 3
            const neutralAnswers = {};
            for (let i = 1; i <= 20; i++) neutralAnswers[`Q${i}`] = 3;

            // Test 1: Q1 min->max should increase Risk by 2030 by  +12 percentage points
            const q1MinAnswers = { ...neutralAnswers, Q1: 1 };
            const q1MaxAnswers = { ...neutralAnswers, Q1: 5 };
            const riskQ1Min = computeRisk2030(q1MinAnswers);
            const riskQ1Max = computeRisk2030(q1MaxAnswers);
            const q1Delta = (riskQ1Max - riskQ1Min) * 100;
            tests.push({
                name: 'Q1 min->max increases Risk by 2030 by 12pp',
                pass: q1Delta >= 12,
                actual: q1Delta.toFixed(1) + 'pp',
                expected: '12pp'
            });

            // Test 2: Q1+Q4+Q6 max yields 2.5 hazard vs neutral
            const maxRiskAnswers = { ...neutralAnswers, Q1: 5, Q4: 5, Q6: 5 };
            const { ampMult: neutralAmpMult, fricMult: neutralFricMult } = computeHazardMultipliers(neutralAnswers);
            const { ampMult: maxAmpMult, fricMult: maxFricMult } = computeHazardMultipliers(maxRiskAnswers);
            const neutralMult = neutralAmpMult * neutralFricMult;
            const maxMult = maxAmpMult * maxFricMult;
            const multRatio = maxMult / neutralMult;
            tests.push({
                name: 'Q1+Q4+Q6 max yields 2.5 hazard vs neutral',
                pass: multRatio >= 2.5,
                actual: multRatio.toFixed(2) + '',
                expected: '2.5'
            });

            // Test 3: Protective stack (Q5+Q7+Q8+Q15 high) suppresses hazard by 50%
            const protectiveAnswers = { ...neutralAnswers, Q5: 5, Q7: 5, Q8: 5, Q15: 5 };
            const { ampMult: protAmpMult, fricMult: protFricMult } = computeHazardMultipliers(protectiveAnswers);
            const protMult = protAmpMult * protFricMult;
            const suppression = (1 - protMult / neutralMult) * 100;
            tests.push({
                name: 'Protective stack suppresses hazard by 50%',
                pass: suppression >= 50,
                actual: suppression.toFixed(1) + '%',
                expected: '50%'
            });

            // Log results to console
            console.log('=== CALIBRATION TEST RESULTS ===');
            tests.forEach(t => {
                const status = t.pass ? ' PASS' : ' FAIL';
                console.log(`${status} - ${t.name}`);
                console.log(`  Expected: ${t.expected}, Actual: ${t.actual}`);
            });
            const allPassed = tests.every(t => t.pass);
            console.log(`\nOverall: ${allPassed ? ' ALL TESTS PASSED' : ' SOME TESTS FAILED'}`);

            return tests;
        }

        function calculateDisplacementProbability(t) {
            const n = 100;
            const dt = t / n;
            let integral = 0;

            for (let i = 0; i <= n; i++) {
                const s = i * dt;
                const rate = hazardAI(s);

                if (i === 0 || i === n) {
                    integral += rate;
                } else if (i % 2 === 1) {
                    integral += 4 * rate;
                } else {
                    integral += 2 * rate;
                }
            }

            integral = integral * dt / 3;
            return 1 - Math.exp(-integral);
        }

        function updateChart() {
            if (!currentParams || !chart) return;

            const years = [];
            const technicalFeasibility = [];
            const actualJobLoss = [];
            const maxYears = 20;
            const delay = currentParams.implementationDelay || 0;

            for (let t = 0; t <= maxYears; t += 0.25) {
                years.push(t);
                // Blue curve: Technical feasibility - Risk_tech(t) = 1 - exp(- lambdaAI(u) du)
                technicalFeasibility.push(calculateDisplacementProbability(t));
                // Green curve: Actual job loss - Risk_actual(t) = Risk_tech(max(t - delay, 0))
                // FIXED: Clamps to 0 to prevent sampling negative time
                actualJobLoss.push(t >= delay ? calculateDisplacementProbability(t - delay) : 0);
            }

            chart.data.labels = years;
            chart.data.datasets[0].data = technicalFeasibility;
            chart.data.datasets[1].data = actualJobLoss;
            chart.update();
            updateResults();

            // Debug: Log key metrics
            console.log('[METR] Blue curve at t=5:', technicalFeasibility[20].toFixed(3));  // t=5 is index 20 (0.25 step)
            console.log('[METR] Green curve at t=5:', actualJobLoss[20].toFixed(3));
            console.log('[METR] Implementation delay:', delay.toFixed(2), 'years');
        }

        function findYearForProbability(targetProb) {
            let low = 0;
            let high = 50;
            let mid;
            
            while (high - low > 0.1) {
                mid = (low + high) / 2;
                const prob = calculateDisplacementProbability(mid);
                
                if (prob < targetProb) {
                    low = mid;
                } else {
                    high = mid;
                }
            }
            
            return mid;
        }

        function describeExplicitness(se) {
            if (typeof se !== 'number') return '-';
            let note;
            if (se >= 0.7) {
                note = 'heavy explicit work pulls timelines forward.';
            } else if (se <= 0.35) {
                note = 'tacit-heavy mix slows capability transfer.';
            } else {
                note = 'mixed tasks keep the acceleration moderate.';
            }
            return `${se.toFixed(2)} - ${note}`;
        }

        function describeTheta(theta, seniority) {
            if (typeof theta !== 'number') return '-';
            const profiles = SENIORITY_PROFILES;
            const baselineProfile = profiles[0] || { thetaLift: 0, label: 'Entry' };
            const baselinePct = (THETA_BASE_ENTRY + (baselineProfile.thetaLift || 0)) * 100;
            const idx = Math.max(0, Math.min(profiles.length - 1, (seniority || 1) - 1));
            const profile = profiles[idx] || baselineProfile;
            const pct = theta * 100;
            const lift = pct - baselinePct;
            let note;
            if (lift > 2) {
                note = `${profile.label} raises the coverage bar by ~${lift.toFixed(1)} pts.`;
            } else if (lift < -2) {
                note = `${profile.label} sits below the entry coverage bar by ~${Math.abs(lift).toFixed(1)} pts.`;
            } else {
                note = `${profile.label} holds roughly the entry-level coverage bar.`;
            }
            return `${pct.toFixed(1)}% - ${note}`;
        }


        function describePace(pace) {
            if (typeof pace !== 'number' || !Number.isFinite(pace)) return '-';
            const multiplier = pace.toFixed(2);
            if (pace > 1.05) {
                return `~${multiplier}x METR doubling time - slower capability transfer.`;
            }
            if (pace < 0.95) {
                return `~${multiplier}x METR doubling time - faster than the trend.`;
            }
            return `~${multiplier}x METR doubling time - close to baseline.`;
        }

        function describeFriction(lambda) {
            if (typeof lambda !== 'number') return '-';
            let band;
            if (lambda >= 0.035) {
                band = 'fast rollout';
            } else if (lambda <= 0.015) {
                band = 'slow rollout';
            } else {
                band = 'medium rollout';
            }
            return `lambda = ${lambda.toFixed(3)} - ${band} damping.`;
        }

        function describeAlignment(alignment, penalty) {
            if (typeof alignment !== 'number' || typeof penalty !== 'number' || !Number.isFinite(penalty)) {
                return '-';
            }
            const alignmentPct = alignment * 100;
            let note;
            if (alignment >= 0.7) {
                note = 'close to METR software tasks.';
            } else if (alignment >= 0.4) {
                note = 'mixed workflows; slower transfer from METR.';
            } else {
                note = 'tacit/physical heavy; METR trend damped.';
            }
            return `${alignmentPct.toFixed(0)}% aligned, horizon penalty ${penalty.toFixed(2)}x - ${note}`;
        }

        function updateResults() {
            const delay = currentParams.implementationDelay || 0;

            // Technical feasibility timeline
            const medianTech = findYearForProbability(0.5);
            const highTech = findYearForProbability(0.9);

            // Actual job loss timeline (add delay)
            const medianActual = medianTech + delay;
            const highActual = highTech + delay;
            const risk2030 = calculateDisplacementProbability(5.35 - delay);
            const risk2031 = calculateDisplacementProbability(6.35 - delay);

            document.getElementById('median-year').textContent =
                medianActual < 50 ? `${medianActual.toFixed(1)} years` : 'Beyond 2050';
            document.getElementById('high-year').textContent =
                highActual < 50 ? `${highActual.toFixed(1)} years` : 'Beyond 2050';
            document.getElementById('risk-2030').textContent =
                `${(Math.max(0, risk2030) * 100).toFixed(1)}%`;
            document.getElementById('risk-2031').textContent =
                `${(Math.max(0, risk2031) * 100).toFixed(1)}%`;

            // Re-employment likelihood (calculated here with medianTech timing)
            const reemployProb = calculateReemploymentProbability(
                currentParams.answers,
                currentParams.seniority,
                medianTech
            );
            const reemployPct = (reemployProb * 100).toFixed(0);
            let reemployLabel = 'Moderate';
            if (reemployProb >= 0.7) reemployLabel = 'Good';
            else if (reemployProb >= 0.5) reemployLabel = 'Moderate';
            else if (reemployProb >= 0.3) reemployLabel = 'Low';
            else reemployLabel = 'Very Low';
            document.getElementById('reemployment-value').textContent =
                `${reemployLabel} (${reemployPct}%)`;

            document.getElementById('insight-explicitness').textContent = describeExplicitness(currentParams.s_e);
            document.getElementById('insight-theta').textContent = describeTheta(currentParams.theta, currentParams.seniority);
            const paceForDisplay = resolvedDomainPace();
            document.getElementById('insight-pace').textContent = describePace(paceForDisplay);
            document.getElementById('insight-friction').textContent = describeFriction(currentParams.lambda);
            document.getElementById('insight-alignment').textContent =
                describeAlignment(currentParams.domainAlignment, currentParams.domainPenalty);

            // Update personal timeline table
            updatePersonalTimeline();
        }

        document.getElementById('ai-doubling')?.addEventListener('input', function() {
            const value = parseFloat(this.value);
            document.getElementById('ai-doubling-value').textContent = value + ' mo';
            console.log('[Slider] AI Doubling:', value, 'months  expect', value < 7 ? 'FASTER' : 'SLOWER', 'automation');
            updateChart();
        });

        document.getElementById('compute-scaling')?.addEventListener('input', function() {
            const computeValue = parseFloat(this.value);
            document.getElementById('compute-scaling-value').textContent = computeValue.toFixed(1) + 'x';
            console.log('[Slider] Compute Scaling:', computeValue.toFixed(1) + 'x',
                       ' expect', computeValue > 3.4 ? 'FASTER' : 'SLOWER', 'automation');
            updateChart();
        });

        document.getElementById('industry-pace')?.addEventListener('input', function() {
            const frictionValue = parseFloat(this.value);
            document.getElementById('industry-pace-value').textContent = frictionValue.toFixed(1) + 'x';
            console.log('[Slider] Industry Friction:', frictionValue.toFixed(1) + 'x',
                       ' expect', frictionValue > 1.0 ? 'SLOWER' : 'FASTER', 'automation');
            updateChart();
        });

        document.getElementById('ai-reliability')?.addEventListener('input', function() {
            const reliabilityValue = parseInt(this.value);
            document.getElementById('ai-reliability-value').textContent = reliabilityValue + '%';
            console.log('[Slider] AI Reliability:', reliabilityValue + '%',
                       ' expect', reliabilityValue > 95 ? 'SLOWER' : 'FASTER', 'automation');
            updateChart();
        });

        // Auto-initialize: select custom role and trigger analysis on page load
        window.addEventListener('DOMContentLoaded', function() {
            const customBtn = document.querySelector('.preset-btn[data-role="custom"]');
            if (customBtn) {
                customBtn.click();
            }

            // Run tests after initial analysis completes
            setTimeout(() => {
                runMETRAcceptanceTests();
                runRegressionTests();
                runPatchRegressionTests();
                runCalibrationTests();
            }, 500);
        });
    </script>
    <script src="navigation.js"></script>
</body>
</html>
